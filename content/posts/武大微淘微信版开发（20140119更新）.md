---
title: 武大微淘微信版开发（20140119更新）
id: 168
categories:
  - 开发笔记
date: 2014-01-19 23:49:35
tags:
  - 武大微淘
  - 微信开发
---

今天似乎没什么好发的，上午半天睡过去了，下午替一个学弟在宿舍楼值班，本来今天想研究一下网页抓取和模拟登录的，实在没时间就没弄了，thinkphp教程看了会，一些基本的概念都很熟了。晚上一直在弄asp cms，实在忍受不了我们学院的网站了，想在回家之前重新设计一遍，任重而道远呐~

还是回到微信开发上来，今天没有实现什么新的功能，就是在昨天的基础上把用户关注时的回复消息改了一下，用户回复“帮助”or“help”时返回几个对应的操作说明，大概就做了用户输入“所有+类型”，如“所有店铺”、“所有商品”时回复对应类型的全部数据，由于微信一次最多只能回复10条图文消息，所以有必要弄一个分页查询功能，今天想了一下，大概的思路有了，借助thinkphp框架，分页查询功能实现起来应该很容易。

还有两天就要回家了，武大微淘的网页版、APP、微信都还没做好，院网和厚德网也没做好，还有答应下学期投入使用的彩虹桥公益网站、厚德工作室网站、青盟团队网站也没做好。。。妈蛋突然发现事情好多，回家前是根本完不成的了。唉。

武大微淘设计的初衷是打造一个校园O2O平台，让校园生活便捷化，所以我一直在想怎么样设计才能让用户更好的接受并习惯。校园O2O方面华科的wexin水果帮和华农的小农女送菜已经做的很成熟了，最近一直在研究他们的微信，觉得功能方面过于简单。我是完美主义者，要么不做，要做的话我肯定希望武大微淘能够实现更多实用的功能，比如四六级成绩查询、快递查询之类的。但是仔细想一想功能做太多会不会太乱太杂，违背我的设计初衷。。。。真心希望有个人能给我点好的建议。

想的有点远了，还是踏踏实实搞开发吧，船到墙头自然直，是驴是马下学期拿出来给用户溜一溜就知道了。

上一段今天实现的功能代码：
```
//自定义函数，回复全部信息
	public function responseAll($fromUsername,$toUsername,$keyword,$time,$textTpl){
				if($keyword=="商品")
                {
              		//实例化店铺“meal_shop”信息表模型
			  		$Data1 = M('meal_menu');
			        //获取记录集
			  		$data1 = $Data1-&gt;limit(8)-&gt;select();
			  		//获取查询记录数
			  		$count=$Data1-&gt;count();
			  		//图文消息返回总数
			  		$showMenu=$count+1;
			  		$resultStr="\n
              		<![CDATA[".$fromUsername."]]>\n
              		<![CDATA[".$toUsername."]]>\n
              		".$time."\n
              		<![CDATA[news]]>\n
              		10\n
              		\n";

              		//添加封面图文消息
              		$resultStr.="\n
              		<![CDATA[共有".$keyword."数:".$count."]]> \n
              		\n
              		\n
              		<![CDATA[http://weitao.bestwhu.com/]]>\n
              		\n";

              		//回复商品信息
			  		foreach($data1 as $item){
              		$resultStr.="\n
              		<![CDATA[【".$item[menu_title]."】\n编号：".$item[menu_id]."\n价格：￥".$item[menu_price]."]]> \n
              		\n
              		<![CDATA[http://weitao.bestwhu.com/".$item[menu_pic]."]]>\n
              		\n
              		\n";
			  		}
					$resultStr.="\n
              		<![CDATA[回复“#+商品编号”购买，如“#3”\n回复“next”查看下一页]]> \n
              		\n
              		<![CDATA[http://weitao.bestwhu.com/".$item[menu_pic]."]]>\n
              		\n
              		\n";
              		$resultStr.="\n
              		0\n
              		";
              		echo $resultStr;
              		exit;
                }
				if($keyword=="店铺")
                {
              		//实例化店铺“meal_shop”信息表模型
			  		$Data1 = M('meal_shop');
			        //获取记录集
			  		$data1 = $Data1-&gt;select();
			  		//获取查询记录数
			  		$count=$Data1-&gt;count();
			  		//图文消息返回总数
			  		$showMenu=$count+1;
			  		$resultStr="\n
              		<![CDATA[".$fromUsername."]]>\n
              		<![CDATA[".$toUsername."]]>\n
              		".$time."\n
              		<![CDATA[news]]>\n
              		".$showMenu."\n
              		\n";

              		//添加封面图文消息
              		$resultStr.="\n
              		<![CDATA[共有".$keyword."数:".$count."]]> \n
              		\n
              		\n
              		<![CDATA[http://weitao.bestwhu.com/]]>\n
              		\n";

              		//回复店铺信息
			  		foreach($data1 as $item){
              		$resultStr.="\n
              		<![CDATA[【".$item[shop_name]."】\n地址：".$item[shop_address]."\n订购电话：".$item[shop_tel]."\n点击进入网站购买]]> \n
              		\n
              		<![CDATA[http://weitao.bestwhu.com/".$item[shop_pic]."]]>\n
              		<![CDATA[http://weitao.bestwhu.com/?app_act=shop&#038;id=$data1[shop_id]]]>\n
              		\n";
			  		}
              		$resultStr.="\n
              		0\n
              		";
              		echo $resultStr;
              		exit;
                }else{
                	$msgType = "text";
					$contentStr = "输入不正确";
                	$resultStr = sprintf($textTpl, $fromUsername, $toUsername, $time, $msgType, $contentStr);
                	echo $resultStr;                
				}
	}
```